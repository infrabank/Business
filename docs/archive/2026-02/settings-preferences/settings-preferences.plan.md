# Plan: settings-preferences

> 설정 페이지 고도화 - 사용자 환경설정, API 키 관리, 보안 설정, 데이터 관리, Danger Zone

## 1. 배경 (Background)

현재 설정 페이지(`/settings`)는 프로필, 조직, 팀 링크, 알림 채널, 구독, 수수료 6개 섹션으로 구성.
MVP 수준으로 기본 기능만 구현되어 있어 다음이 부족함:

- **환경설정**: 통화(USD/KRW), 날짜 형식, 대시보드 기본 기간 등 사용자 선호 설정 없음
- **API 키 관리**: 프로바이더 페이지에서만 관리 가능, 설정에서 통합 뷰 없음
- **보안**: 비밀번호 변경, 세션 관리 등 보안 기능 없음
- **데이터 관리**: 데이터 내보내기/삭제 기능 없음
- **Danger Zone**: 계정 삭제, 조직 삭제 등 위험 작업 없음
- **탭 네비게이션**: 현재 한 페이지에 모든 섹션이 나열되어 길어짐

## 2. 목표 (Goals)

1. 설정 페이지를 탭 기반으로 재구성하여 UX 개선
2. 사용자 환경설정 (통화, 날짜 형식, 대시보드 기본값) 추가
3. API 키 통합 관리 뷰 제공
4. 보안 설정 (비밀번호 변경) 추가
5. Danger Zone (계정 삭제, 데이터 초기화) 추가
6. 설정값을 bkend DB에 저장하여 세션 간 유지

## 3. 기능 요구사항 (Functional Requirements)

### FR-01: 탭 기반 설정 네비게이션
- 설정 페이지를 탭으로 분리: 일반 | 조직 | 알림 | 구독 | 보안
- URL hash 또는 query param으로 탭 상태 유지
- 모바일: 드롭다운 셀렉터로 전환

### FR-02: 사용자 환경설정 (Preferences)
- **통화 표시**: USD (기본) / KRW / EUR / JPY
- **날짜 형식**: YYYY-MM-DD (기본) / MM/DD/YYYY / DD/MM/YYYY
- **대시보드 기본 기간**: 7일 / 30일 (기본) / 90일
- **숫자 형식**: 1,000.00 (기본) / 1.000,00
- bkend `/user-preferences` 컬렉션에 저장
- Zustand store에 캐시하여 앱 전체에서 사용

### FR-03: 프로필 강화
- 프로필 사진 업로드 (bkend file storage)
- 이름 변경 (기존 유지)
- 이메일은 읽기 전용 (Supabase auth에서 관리)

### FR-04: API 키 통합 뷰
- 모든 프로바이더의 API 키를 한 곳에서 조회
- 키 마스킹 (sk-...xxxx) 표시
- 키 추가/삭제 링크 → 프로바이더 페이지로 이동
- 마지막 사용 시간 표시

### FR-05: 보안 설정
- 비밀번호 변경 (현재 비밀번호 + 새 비밀번호 + 확인)
- Supabase `updateUser({ password })` 활용
- 마지막 로그인 시간 표시

### FR-06: Danger Zone
- **데이터 초기화**: usage-records 삭제 (조직 단위)
- **계정 삭제**: 사용자 계정 + 조직 + 모든 데이터 삭제
- 확인 모달: 조직 이름 또는 "DELETE" 입력 필수
- Growth 구독 시: Stripe 구독 먼저 해지 안내

### FR-07: 조직 설정 강화
- 조직 이름/슬러그/청구이메일 (기존 유지)
- 기본 프로젝트 설정
- 조직 삭제 (Danger Zone에서)

### FR-08: 설정 API
- `GET/PATCH /api/settings/preferences` - 사용자 환경설정 CRUD
- `POST /api/settings/change-password` - 비밀번호 변경
- `DELETE /api/settings/account` - 계정 삭제
- `DELETE /api/settings/data` - 데이터 초기화

## 4. 비기능 요구사항 (Non-Functional)

- 설정 저장 시 낙관적 업데이트 (즉시 UI 반영, 백그라운드 저장)
- Danger Zone 작업은 확인 모달 + 타이핑 확인 필수
- 탭 전환 시 로딩 없음 (클라이언트 사이드 전환)
- 모바일 반응형 레이아웃

## 5. Plan Limits

| 기능 | Free | Growth |
|------|------|--------|
| 환경설정 | 전체 | 전체 |
| 프로필 사진 | 불가 | 가능 |
| 비밀번호 변경 | 가능 | 가능 |
| 데이터 초기화 | 가능 | 가능 |
| 계정 삭제 | 가능 | 구독 해지 후 가능 |

## 6. 우선순위

| 순위 | 기능 | 이유 |
|------|------|------|
| P0 | FR-01 탭 네비게이션 | UX 기반, 모든 기능의 컨테이너 |
| P0 | FR-02 환경설정 | 핵심 사용자 경험 |
| P0 | FR-08 설정 API | 백엔드 지원 |
| P1 | FR-05 보안 설정 | 비밀번호 변경 필수 기능 |
| P1 | FR-06 Danger Zone | 계정 삭제 GDPR 관련 |
| P2 | FR-03 프로필 강화 | 프로필 사진은 부가 기능 |
| P2 | FR-04 API 키 통합 뷰 | 편의 기능 |
| P2 | FR-07 조직 설정 강화 | 기존 기능 확장 |

## 7. 성공 기준

- 설정 페이지가 5개 탭으로 구성됨
- 환경설정이 DB에 저장되고 앱 전체에서 적용됨
- 비밀번호 변경이 정상 동작함
- Danger Zone에서 계정/데이터 삭제 가능
- 빌드 에러 0
